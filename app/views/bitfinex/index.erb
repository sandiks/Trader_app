<%= partial 'buy_sell_dialog' %>
<%= partial 'text_price_dialog' %>

<script type="text/javascript">

$(function() {
    bigTick();

    $('#btn_refresh_balance').click(function() {
      $.get('/bitfinex/refresh_balance', function(data) {
          $('#tick').html(data);
          bind_tick_table_rate_button();
          //location.reload();
          
      });
    });    
    $('#btn_refresh_orders').click(function() {
      if(!window.confirm( 'Are you sure?' )){
            return
      }

      $.get('/bitfinex/refresh_orders', function(data) {
          alert(data);
      });
    }); 
    
    $('.btn_load_orders').click(function() {
      var market = $(this).data('market');
      $.get('/order/load_orders/'+market, function(data) {
          alert(data);
      });
    }); 


///////// toggle real / simulate


    $('.btn_set_pump_level').click(function() {
      var curr = $(this).data('curr');
      var level = $(this).data('level');

      $.get('/manage/set_pumped/',{curr:curr,level:level}, function(data) {
          alert(data);
      });
    }); 

});

function bigTick() {
    setTimeout(bigTick,30000);

    $.get('/bitfinex/big_tick', function(data) {
        $('#tick').html(data);
        bind_tick_table_delete_simul_button();
    });
}

function bind_tick_table_delete_simul_button(){

    $('.btn_tick_table_delete_simul_pair').click(function() {
      var pair = $(this).data('curr');

      $.get('/bitfinex/delete_from_simul/',{pair:pair}, function(data) {
          alert(data);
      });
    });         
}

</script>

<div style="margin-left:20px;">

  <button id='btn_refresh_balance' class="btn_style_red"> REFRESH BALANCE</button>
  <button id='btn_refresh_orders' class="btn_style_red"> REFRESH ORDERS</button>
  <button class="btn_open_orders btn_style_red" data-market="all">ALL OPENED_ORDERS</button>
</div>



<div id="tick" style="color:green;margin: 20px;20px;0px;0px">
    tick
</div>

<div style="margin-left:20px;">


  <div style="color:red;">
    TRADE,  <%= get_trading_mode %>
  </div>
  
  <div id="line_tick" style="color:green;margin-bottom: 20px;">      
  </div>  
 
<div style="margin-left:20px;">
  <table class="forumTable" style="width:70%;">
      <tr>
        <th style='width:5%;'>symb_id</th>
        <th style='width:10%;'>pair</th>
        <th style='width:10%;'>bid</th>
        <th style='width:10%;'>ask</th>
        <th style='width:15%;'>[BUY/SELL]</th>
        <th>HISTORY</th>
      </tr>    

      <% @symbols.each do |item|
        next unless @ticks[item[:symbol_id]] 
      %> 
        <tr> 
          <td><%= item[:symbol_id]%> </td>
          <td><%= item[:title]%></td>
          <td><%= '%0.8f' % @ticks[item[:symbol_id]][0] %></td>
          <td><%= '%0.8f' % @ticks[item[:symbol_id]][1] %></td>
          <td>
            <button class="btn_buy_sell btn_style_green" data-curr="<%=item[:name]%>" >buy/sell <%=item[:title] %></button>
            <br />
          </td>
        </tr>
      <% end%>
 </table>
</div>
</div>
